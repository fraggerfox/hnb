LIBS=-lcurses libcli/libcli.a
CFLAGS=-I.. -Ilibcli -DHAVE_CONFIG_H -Wall -O2 

CFILES=$(wildcard *.c)
OBJS=$(patsubst %.c,%.o,$(CFILES))

hnb: libcli/libcli.a Makefile $(OBJS) init_subsystems.c *.h *.inc
	cc -o hnb $(OBJS) $(LIBS) $(CFLAGS)
libcli/libcli.a: libcli/*.c
	(cd libcli;make)
libcli/libcli_p.a: libcli/*.c
	(cd libcli;make libcli_p.a)
init_subsystems.c: *.c
	echo "/* this file is autogenerated, do not edit */">init_subsystems.c
	cat *.c | grep "^\!init_" | sort | sed -e "s/^\!/void /g">>init_subsystems.c
	echo "">>init_subsystems.c
	echo "void init_subsystems(){">>init_subsystems.c
	cat *.c | grep "^\!init_" | sort | sed -e "s/^\!/ /g">>init_subsystems.c
	echo "}">>init_subsystems.c
clean:
	rm -f xml_debug hnb $(OBJS) *~ cli_*.inc
	(cd libcli;make clean)
hnb_p: *.c libcli/libcli_p.a init_subsystems.c
	cc -o hnb_p *.c -pg -lncurses_p libcli/libcli_p.a -I.. -Ilibcli -DHAVE_CONFIG_H

ps:
	dot -Tps xml.dot > xml_states.ps
